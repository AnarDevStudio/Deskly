local function get_network_interface()
local handle = io.popen('ip a | grep "state UP" | cut -d: -f2 | tr -d " "')
local interfaces = {}
for line in handle:lines() do
table.insert(interfaces, line)
end
handle:close()
local wifi_interface = nil
local other_interfaces = {}
for _, iface in ipairs(interfaces) do
if iface:match('^w') then
wifi_interface = iface
elseif iface:match('^e') or iface:match('^l') or iface:match('^v') then
table.insert(other_interfaces, iface)
end
end
if wifi_interface then
return wifi_interface
elseif #other_interfaces >= 1 then
return other_interfaces[1]
elseif #interfaces >= 1 then
return interfaces[1]
else
return ""
end
end
local function setup_templates()
local manual_names = {}
local manual_paths = {}
local network_interface = nil
local temp_unit_override = nil
local target_names = {"MOUNT_NAME_1", "MOUNT_NAME_2", "MOUNT_NAME_3", "MOUNT_NAME_4"}
local target_paths = {"MOUNT_PATH_1", "MOUNT_PATH_2", "MOUNT_PATH_3", "MOUNT_PATH_4"}
local config_file_path = os.getenv("HOME") .. "/.config/conky/Mimod-white/scripts/config"
local file = io.open(config_file_path, "r")
if file then
local content = file:read("*all")
file:close()
local net_match = content:match('NET_INTERFACE="([^"]*)"')
if net_match then network_interface = net_match end
local temp_match = content:match('TEMP_UNIT_OVERRIDE="([^"]*)"')
if temp_match then temp_unit_override = temp_match end
for i, name in ipairs(target_names) do
local value = content:match(name .. '="([^"]*)"')
if value then manual_names[i] = value end
end
for i, path in ipairs(target_paths) do
local value = content:match(path .. '="([^"]*)"')
if value then manual_paths[i] = value end
end
end
local mount_script = 'sh -c "exec $HOME/.config/conky/Mimod-white/scripts/get_mounts.sh"'
local handle = io.popen(mount_script)
local values = {}
for line in handle:lines() do
table.insert(values, line)
end
if handle then handle:close() end
local function get_path(index)
local manual = manual_paths[index]
if manual and manual ~= "" then
return manual
else
return values[index] or "/dev/null"
end
end
local function get_name(index, fallback_value)
local manual = manual_names[index]
if manual and manual ~= "" then
return manual
else
return values[index + 4] or fallback_value
end
end
local auto_iface = get_network_interface()
local final_iface = (network_interface and network_interface ~= "") and network_interface or auto_iface
return {
interface = final_iface,
temp_unit = (temp_unit_override and temp_unit_override ~= "") and temp_unit_override or nil,
template8 = get_path(1),
template1 = get_path(2),
template2 = get_path(3),
template3 = get_path(4),
template4 = get_name(1, "N/A"),
template5 = get_name(2, "N/A"),
template6 = get_name(3, "N/A"),
template7 = get_name(4, "N/A"),
}
end
local templates = setup_templates()
conky.config = {
template0 = templates.interface,
template8 = templates.template8,
template1 = templates.template1,
template2 = templates.template2,
template3 = templates.template3,
template4 = templates.template4,
template5 = templates.template5,
template6 = templates.template6,
template7 = templates.template7,
template9 = templates.temp_unit,
alignment = 'top_left',
gap_x = 50,
gap_y = 30,
maximum_width = 400,
minimum_height = 820,
minimum_width = 400,
use_xft = true,
override_utf8_locale = true,
font = 'Bebas Neue:dark:size=9',
default_color = '#000000',
default_outline_color = 'white',
default_shade_color = 'white',
color1 = '#eeeeee',
color2 = '#7AA2F7',
color3 = '#999999',
background = true,
border_width = 1,
draw_borders = false,
draw_graph_borders = false,
draw_outline = false,
draw_shades = false,
own_window = true,
own_window_colour = 'FFFFFF',
own_window_class = 'Conky',
own_window_type = 'dock',
draw_blended = true,
own_window_argb_visual = true,
own_window_argb_value = 255,
own_window_transparent = true,
own_window_hints = 'undecorated,below,sticky,skip_taskbar,skip_pager',
stippled_borders = 0,
top_cpu_separate = false,
cpu_avg_samples = 2,
net_avg_samples = 2,
double_buffer = true,
out_to_console = false,
out_to_stderr = false,
extra_newline = false,
update_interval = 1.0,
uppercase = false,
use_spacer = 'none',
show_graph_scale = false,
show_graph_range = false,
imlib_cache_size = 512,
lua_load = '$HOME/.config/conky/Mimod-white/scripts/rings.lua',
lua_draw_hook_post = 'ring_stats',
}
conky.text = [[
${execi 420 sh -c '$HOME/.config/conky/Mimod-white/scripts/weather.sh &'}\
${image $HOME/.config/conky/Mimod-white/res/dark.png -s 360x775 -p 5,40}
${offset 20}${voffset 45}${color1}${font feather:size=42}${execi 105 $HOME/.config/conky/Mimod-white/scripts/weather-text-icon}${goto 95}${font Bebas Neue:size=26}${execi 105 $HOME/.config/conky/Mimod-white/scripts/get-weather.sh temp}${execi 420 $HOME/.config/conky/Mimod-white/scripts/weather-unit.sh temp}${font}
${offset 20}${voffset 5}${color1}${font Feather:bold:size=6} ${font Abel:bold:size=5}${execi 420 $HOME/.config/conky/Mimod-white/scripts/get-weather.sh name}${font}
${offset 20}${voffset 10}${color1}${font Abel:size=11}${execi 105 $HOME/.config/conky/Mimod-white/scripts/get-weather.sh desc}${font}
${offset 20}${voffset 20}${color1}${font Feather:bold:size=9} ${font Abel:size=9}${execi 105 $HOME/.config/conky/Mimod-white/scripts/get-weather.sh wind} ${execi 420 $HOME/.config/conky/Mimod-white/scripts/weather-unit.sh wind}${goto 110}${font Feather:bold:size=9} ${font Abel:size=9}${execi 105 $HOME/.config/conky/Mimod-white/scripts/get-weather.sh humidity}%
${offset 210}${voffset -140}${color1}${font Feather:bold:size=14}${font Abel:bold:size=10} :  ${execi 309 $HOME/.config/conky/Mimod-white/scripts/ssid ${template0}}
${offset 215}${voffset -2}${color3}${font Feather:bold:size=8} ${font Abel:bold:size=7}${upspeed ${template0}}
${offset 215}${voffset 90}${color3}${font Feather:bold:size=8} ${font Abel:bold:size=7}${downspeed ${template0}}
${offset 45}${voffset 76}${color1}${font Feather:size=22}${goto 134}${goto 218}${goto 302}
${offset 43}${voffset 20}${color3}${font Bebas Neue:size=20}${cpu cpu0}%${goto 130}${memperc}%${goto 205}/ ${fs_used_perc /}%${goto 295}${lua conky_cpu_temp}
${offset 41}${voffset 59}${color1}${font Feather:size=15}${goto 127}
${offset 30}${voffset 6}${color1}${font Abel:bold:size=8}${template4} ${fs_used_perc ${template8}}%${goto 115}${template5} ${fs_used_perc ${template1}}%
${offset 41}${voffset 30}${color1}${font Feather:size=15}${goto 127}
${offset 30}${voffset 6}${color1}${font Abel:bold:size=8}${template6} ${fs_used_perc ${template2}}%${goto 115}${template7} ${fs_used_perc ${template3}}%
${offset 210}${voffset -145}${color1}${font Feather:size=26}${execi 2 $HOME/.config/conky/Mimod-white/scripts/playerctl-status.sh}${font}
${offset 210}${voffset 0}${color1}${font Abel:size=10}${execi 2 playerctl status 2>/dev/null}
${offset 210}${voffset 20}${color3}${font Abel:bold:size=14}${execi 2 $HOME/.config/conky/Mimod-white/scripts/playerctl.sh -a}${font}
${offset 210}${voffset 5}${color1}${font Abel:bold:size=9}${execi 2 $HOME/.config/conky/Mimod-white/scripts/playerctl.sh -t}${font}
${offset 210}${voffset 10}${color1}${font Abel:size=9}${execi 2 (playerctl position --format "{{ duration(position) }}" 2>/dev/null || echo "")}
${offset 25}${voffset 50}${color1}${font Feather:size=22}
${alignc 0}${voffset -40}${color3}${font Allura:bold:size=13}${execpi 3150 $HOME/.config/conky/Mimod-white/scripts/quote.sh | sed ':a;N;$!ba;s/\n/\n${alignc 0}${voffset 0}/g'}${font}
${execp $HOME/.config/conky/Mimod-white/scripts/playerctl.sh -c}
]]
